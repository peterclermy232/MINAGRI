<main id="main" class="main">
  <div class="pagetitle">
    <h1>Manage Organization</h1>
    <nav>
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a routerLink="/">Home</a></li>
        <li class="breadcrumb-item">Dashboard</li>
        <li class="breadcrumb-item active">Manage Organizations</li>
      </ol>
    </nav>
  </div>

  <section class="section">
    <nav class="navbar navbar-light">
      <div class="container-fluid">
        <div class="text-right flex-right">
          <button
            (click)="showModal()"
            class="justify-content-end btn btn-success"
            type="button"
            data-bs-toggle="modal"
            data-bs-target="#exampleModal">
            Add New Organization
          </button>
          <button
            (click)="getOrganizations()"
            class="justify-content-end btn btn-primary"
            type="button">
            <i class="fas fa-sync" [class.fa-spin]="organizations.loading"></i>
            Refresh Organizations
          </button>
        </div>
      </div>
    </nav>

    <!-- Loading Spinner -->
    <div *ngIf="organizations.loading" class="text-center mt-4">
      <div class="spinner-border" role="status">
        <span class="sr-only">Loading...</span>
      </div>
      <p class="mt-2">Loading organizations...</p>
    </div>

    <!-- Organizations Table -->
    <div *ngIf="!organizations.loading">
      <div class="table-responsive">
        <table class="table table-bordered table-striped table-hover mt-3 w-100">
          <thead class="thead-dark">
            <tr>
              <th>Organization Code</th>
              <th>Organization Name</th>
              <th>Organization Type</th>
              <th>Country</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Contact Person</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let org of organizations.data">
              <td>{{ org.organisation_code }}</td>
              <td>{{ org.organisation_name }}</td>
              <td>{{ org.organisation_type }}</td>
              <td>{{ org.country }}</td>
              <td>{{ org.organisation_email }}</td>
              <td>{{ org.organisation_msisdn }}</td>
              <td>{{ org.organisation_contact }}</td>
              <td>
                <span
                  class="badge"
                  [ngClass]="{
                    'badge-success': org.organisation_status === 'ACTIVE',
                    'badge-danger': org.organisation_status === 'INACTIVE',
                    'badge-warning': org.organisation_status === 'PENDING'
                  }">
                  {{ org.organisation_status }}
                </span>
              </td>
              <td>
                <button
                  (click)="showModal(org)"
                  class="btn btn-sm btn-warning"
                  data-bs-toggle="modal"
                  data-bs-target="#exampleModal">
                  <i class="fas fa-edit"></i> Edit
                </button>
              </td>
            </tr>
            <tr *ngIf="organizations.data.length === 0">
              <td colspan="9" class="text-center">
                <p class="text-muted mb-0">No organizations found</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>


    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">{{modalMode.label}}</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <form (ngSubmit)="handleSubmit()" [formGroup]="organizationForm">
            <div class="modal-body">
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Organization Code <span class="text-danger">*</span></label>
                    <input type="text" formControlName="organisation_code" class="form-control">
                    <app-error-section
                      [formSubmitted]="formSubmitted"
                      inputProperty="organisation_code"
                      [inputObject]="this.organizationForm.get('organisation_code')"
                    ></app-error-section>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Organization Name <span class="text-danger">*</span></label>
                    <input type="text" formControlName="organisation_name" class="form-control">
                    <app-error-section
                      [formSubmitted]="formSubmitted"
                      inputProperty="organisation_name"
                      [inputObject]="this.organizationForm.get('organisation_name')"
                    ></app-error-section>
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Organization Email <span class="text-danger">*</span></label>
                    <input type="email" formControlName="organisation_email" class="form-control">
                    <app-error-section
                      [formSubmitted]="formSubmitted"
                      inputProperty="organisation_email"
                      [inputObject]="this.organizationForm.get('organisation_email')"
                    ></app-error-section>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Organization Phone <span class="text-danger">*</span></label>
                    <input type="text" formControlName="organisation_msisdn" class="form-control">
                    <app-error-section
                      [formSubmitted]="formSubmitted"
                      inputProperty="organisation_phone"
                      [inputObject]="this.organizationForm.get('organisation_msisdn')"
                    ></app-error-section>
                  </div>
                </div>
              </div>

              <div class="mb-3">
                <label class="form-label">Organization Contact Person <span class="text-danger">*</span></label>
                <input type="text" formControlName="organisation_contact" class="form-control" placeholder="name - phone number">
                <app-error-section
                  [formSubmitted]="formSubmitted"
                  inputProperty="organisation_contact"
                  [inputObject]="this.organizationForm.get('organisation_contact')"
                ></app-error-section>
              </div>

              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Organization Type <span class="text-danger">*</span></label>
                    <select class="form-control" formControlName="organisation_type_id">
                      <option value="">Select Organization Type</option>
                      <option *ngFor="let orgType of organizationTypes" [value]="orgType.organisation_type_id">
                        {{orgType.organisation_type}}
                      </option>
                    </select>
                    <app-error-section
                      [formSubmitted]="formSubmitted"
                      inputProperty="organisation_type"
                      [inputObject]="this.organizationForm.get('organisation_type_id')"
                    ></app-error-section>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Country <span class="text-danger">*</span></label>
                    <select class="form-control" formControlName="country_id">
                      <option value="">Select Country</option>
                      <option *ngFor="let cty of countries" [value]="cty.country_id">
                        {{cty.country}}
                      </option>
                    </select>
                    <app-error-section
                      [formSubmitted]="formSubmitted"
                      inputProperty="country"
                      [inputObject]="this.organizationForm.get('country_id')"
                    ></app-error-section>
                  </div>
                </div>
              </div>

              <div class="mb-3">
                <label class="form-label">Status <span class="text-danger">*</span></label>
                <select class="form-control" formControlName="organisation_status">
                  <option value="ACTIVE">Active</option>
                  <option value="INACTIVE">Inactive</option>
                  <option value="PENDING">Pending</option>
                </select>
                <app-error-section
                  [formSubmitted]="formSubmitted"
                  inputProperty="status"
                  [inputObject]="this.organizationForm.get('organisation_status')"
                ></app-error-section>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" id="cancel" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button [disabled]="modalBtn.loading" type="submit" [class]="modalBtn.classes">
                <span *ngIf="modalBtn.loading" class="spinner-border spinner-border-sm mr-1"></span>
                {{modalBtn.text}}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </section>
</main>
