<main id="main" class="main">
  <div class="pagetitle">
      <h1>Open Claims</h1>
      <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a routerLink="/">Home</a></li>
          <li class="breadcrumb-item">Dashboard</li>
          <li class="breadcrumb-item active">Open Claims</li>
        </ol>
      </nav>
    </div>
  <section class="section">

<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header bg-warning text-white">
          <h3 class="card-title mb-0">
            <i class="fas fa-folder-open mr-2"></i>Open Claims
          </h3>
          <div class="card-tools">
            <button class="btn btn-sm btn-light mr-2" (click)="exportToExcel()">
              <i class="fas fa-file-excel"></i> Export
            </button>
            <button class="btn btn-sm btn-light" (click)="loadOpenClaims()">
              <i class="fas fa-sync"></i> Refresh
            </button>
          </div>
        </div>

        <div class="card-body">
          <!-- Alert Messages -->
          <div *ngIf="error" class="alert alert-danger alert-dismissible">
            <button type="button" class="close" (click)="error = ''">&times;</button>
            <i class="fas fa-exclamation-triangle mr-2"></i>{{ error }}
          </div>

          <!-- Statistics Row -->
          <div class="row mb-4">
            <div class="col-md-4">
              <div class="info-box bg-warning">
                <span class="info-box-icon"><i class="fas fa-folder-open"></i></span>
                <div class="info-box-content">
                  <span class="info-box-text">Open Claims</span>
                  <span class="info-box-number">{{ filteredClaims.length }}</span>
                </div>
              </div>
            </div>
            <div class="col-md-8">
              <div class="info-box bg-info">
                <span class="info-box-icon"><i class="fas fa-money-bill-wave"></i></span>
                <div class="info-box-content">
                  <span class="info-box-text">Total Estimated Loss</span>
                  <span class="info-box-number">{{ formatCurrency(getTotalEstimatedLoss()) }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Search Bar -->
          <div class="row mb-3">
            <div class="col-md-6">
              <div class="input-group">
                <input type="text"
                       class="form-control"
                       [(ngModel)]="searchTerm"
                       (keyup)="applySearch()"
                       placeholder="Search by claim number, farmer name, or policy number...">
                <div class="input-group-append">
                  <button class="btn btn-outline-secondary" type="button" (click)="applySearch()">
                    <i class="fas fa-search"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Loading Spinner -->
          <div *ngIf="loading" class="text-center py-5">
            <div class="spinner-border text-warning" role="status">
              <span class="sr-only">Loading...</span>
            </div>
            <p class="mt-2">Loading open claims...</p>
          </div>

          <!-- Claims Table -->
          <div *ngIf="!loading" class="table-responsive">
            <table class="table table-bordered table-hover table-striped">
              <thead class="thead-light">
                <tr>
                  <th>#</th>
                  <th>Claim Number</th>
                  <th>Farmer Name</th>
                  <th>Policy Number</th>
                  <th>Estimated Loss</th>
                  <th>Status</th>
                  <th>Claim Date</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let claim of paginatedClaims; let i = index">
                  <td>{{ (currentPage - 1) * pageSize + i + 1 }}</td>
                  <td>
                    <strong class="text-warning">{{ claim.claim_number }}</strong>
                  </td>
                  <td>{{ claim.farmer_name }}</td>
                  <td>{{ claim.policy_number }}</td>
                  <td class="text-right">{{ formatCurrency(claim.estimated_loss_amount) }}</td>
                  <td>
                    <span class="badge badge-warning">
                      <i class="fas fa-clock mr-1"></i>{{ claim.status }}
                    </span>
                  </td>
                  <td>{{ formatDate(claim.claim_date) }}</td>
                  <td>
                    <button class="btn btn-sm btn-info mr-1"
                            (click)="viewDetails(claim)"
                            title="View Details">
                            <i class="bi bi-pencil"></i>
                      <!-- <i class="fas fa-eye"></i> -->
                    </button>
                    <button class="btn btn-sm btn-primary"
                            (click)="assignToAssessor(claim)"
                            title="Assign to Assessor">
                      <i class="bi bi-person-plus"></i>
                    </button>
                  </td>
                </tr>
                <tr *ngIf="paginatedClaims.length === 0">
                  <td colspan="8" class="text-center py-4">
                    <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                    <p class="text-muted">No open claims found</p>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Pagination -->
          <div class="row mt-3" *ngIf="filteredClaims.length > pageSize">
            <div class="col-md-6">
              <p class="text-muted">
                Showing {{ (currentPage - 1) * pageSize + 1 }} to
                {{ getMin(currentPage * pageSize, filteredClaims.length) }} of
                {{ filteredClaims.length }} entries
              </p>
            </div>
            <div class="col-md-6">
              <nav>
                <ul class="pagination justify-content-end mb-0">
                  <li class="page-item" [class.disabled]="currentPage === 1">
                    <a class="page-link" (click)="previousPage()">Previous</a>
                  </li>
                  <li class="page-item"
                      *ngFor="let page of [].constructor(getMin(5, totalPages)); let i = index"
                      [class.active]="currentPage === i + 1">
                    <a class="page-link" (click)="goToPage(i + 1)">{{ i + 1 }}</a>
                  </li>
                  <li class="page-item" [class.disabled]="currentPage === totalPages">
                    <a class="page-link" (click)="nextPage()">Next</a>
                  </li>
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Claim Details Modal -->
<div class="modal fade" [style.display]="showDetailsModal ? 'block' : 'none'" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-warning text-white">
        <h5 class="modal-title">
          <i class="fas fa-folder-open mr-2"></i>Claim Details
        </h5>
        <button type="button" class="close text-white" (click)="closeDetailsModal()">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body" *ngIf="selectedClaim">
        <div class="row">
          <div class="col-md-6">
            <h6 class="border-bottom pb-2">Claim Information</h6>
            <table class="table table-sm">
              <tr>
                <td><strong>Claim Number:</strong></td>
                <td>{{ selectedClaim.claim_number }}</td>
              </tr>
              <tr>
                <td><strong>Status:</strong></td>
                <td><span class="badge badge-warning">{{ selectedClaim.status }}</span></td>
              </tr>
              <tr>
                <td><strong>Claim Date:</strong></td>
                <td>{{ formatDate(selectedClaim.claim_date) }}</td>
              </tr>
              <tr>
                <td><strong>Estimated Loss:</strong></td>
                <td class="text-danger font-weight-bold">
                  {{ formatCurrency(selectedClaim.estimated_loss_amount) }}
                </td>
              </tr>
            </table>
          </div>
          <div class="col-md-6">
            <h6 class="border-bottom pb-2">Farmer & Policy</h6>
            <table class="table table-sm">
              <tr>
                <td><strong>Farmer Name:</strong></td>
                <td>{{ selectedClaim.farmer_name }}</td>
              </tr>
              <tr>
                <td><strong>Policy Number:</strong></td>
                <td>{{ selectedClaim.policy_number }}</td>
              </tr>
            </table>
          </div>
        </div>

        <div class="alert alert-info mt-3">
          <i class="fas fa-info-circle mr-2"></i>
          <strong>Next Steps:</strong> This claim needs to be assigned to a loss assessor for evaluation.
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="assignToAssessor(selectedClaim!)">
          <i class="fas fa-user-plus mr-2"></i>Assign Assessor
        </button>
        <button type="button" class="btn btn-secondary" (click)="closeDetailsModal()">
          Close
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Backdrop -->
<div class="modal-backdrop fade show" *ngIf="showDetailsModal"></div>

 </section>
</main>
